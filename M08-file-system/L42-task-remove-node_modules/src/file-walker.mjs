import url from 'node:url';
import { readdir } from 'node:fs/promises';
import path from 'node:path'

const __dirname = url.fileURLToPath(new url.URL(".", import.meta.url))

const directoryExclusions = ['.git', 'node_modules', '.idea', '.vscode', 'dist'];

export async function fileWalker(segments = ['.']) {
    const result = await readdir(path.join(__dirname, ...segments), {withFileTypes: true});

    const foundNodeModules = [];
    for(const dirent of result) {
      if(dirent.isDirectory() && !directoryExclusions.includes(dirent.name)) {
        foundNodeModules.push(...await fileWalker([...segments, dirent.name]))
      }
      if(dirent.name === 'node_modules') {
        foundNodeModules.push(dirent);
      }
    }

    return foundNodeModules;
}
